{% extends "base.html" %}

{% block title %}Checkout - Playwright Demo Store{% endblock %}

{% block content %}
<section class="checkout-container" data-testid="checkout-container">
    <h1 role="heading" aria-level="1">Checkout</h1>
    
    <form class="checkout-form" id="checkoutForm" data-testid="checkout-form">
        <h2>Shipping Information</h2>
        
        <div class="form-group">
            <label for="shipping-address">Shipping Address</label>
            <input 
                type="text" 
                id="shipping-address" 
                data-testid="shipping-address-input"
                required
            />
        </div>
        
        <div class="form-group">
            <label for="shipping-city">City</label>
            <input 
                type="text" 
                id="shipping-city" 
                data-testid="shipping-city-input"
                required
            />
        </div>
        
        <div class="form-group checkbox-group">
            <input 
                type="checkbox" 
                id="accept-terms" 
                data-testid="accept-terms-checkbox"
                required
            />
            <label for="accept-terms">I accept the terms and conditions</label>
        </div>
        
        <div class="checkout-message" data-testid="checkout-message" role="status" style="display: none;"></div>
        
        <button type="submit" class="btn-primary btn-large" data-testid="place-order-button">
            Place Order
        </button>
    </form>
</section>

<script>
document.getElementById('checkoutForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const address = document.querySelector('[data-testid="shipping-address-input"]').value;
    const city = document.querySelector('[data-testid="shipping-city-input"]').value;
    const termsAccepted = document.querySelector('[data-testid="accept-terms-checkbox"]').checked;
    const messageDiv = document.querySelector('[data-testid="checkout-message"]');
    
    if (!termsAccepted) {
        messageDiv.textContent = 'Please accept the terms and conditions';
        messageDiv.style.color = 'red';
        messageDiv.style.display = 'block';
        return;
    }
    
    try {
        const response = await fetch('/api/place-order', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ address, city })
        });
        
        const data = await response.json();
        
        if (data.success) {
            messageDiv.textContent = `Order placed successfully! Order ID: ${data.order_id}`;
            messageDiv.style.color = 'green';
            messageDiv.style.display = 'block';
            
            localStorage.removeItem('cart');
            document.querySelector('[data-testid="cart-count"]').textContent = '0';
        }
    } catch (error) {
        messageDiv.textContent = 'Failed to place order';
        messageDiv.style.color = 'red';
        messageDiv.style.display = 'block';
    }
});
</script>
{% endblock %}
